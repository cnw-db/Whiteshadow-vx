//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê//
//                WHITESHADOW-MD                 //
//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê//
//  ‚ö° Command : .cz / .czinfo / .czdl
//  üé¨ Feature : CineSubz Sinhala Subtitle Movie Downloader
//  üëë Developer : Chamod Nimsara (WhiteShadow)
//  üì° API Source : asitha.top (foreign-marna-sithaunarathnapromax)
//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê//

  //obfuscator by whiteshadow ai üòò
//*ÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕöÕö*  *//











/* Obfuscated by WhiteShadow - https://whatsapp.com/channel/0029Vak4dFAHQbSBzyxlGG13 */
const { cmd } = require('../command');
const fetch = require('node-fetch');

cmd({
  pattern: "msearch",
  desc: "Search and get movies with download links",
  category: "movie",
  react: "üé¨"
}, async (conn, mek, m, { args }) => {
  try {
    if (!args[0]) return await m.reply("üìå Use: *.msearch movie name*\nExample: *.msearch Black Panther*");

    const query = args.join(" ");
    const searchURL = `https://movieapi.giftedtech.co.ke/api/search/${encodeURIComponent(query)}`;

    const searchRes = await fetch(searchURL);
    const searchData = await searchRes.json();

    if (!searchData.results?.items?.length)
      return m.reply("‚ùå Movie not found!");

    const firstMovie = searchData.results.items[0];
    const movieId = firstMovie.subjectId;

    const infoRes = await fetch(`https://movieapi.giftedtech.co.ke/api/info/${movieId}`);
    const infoData = await infoRes.json();

    const sourceRes = await fetch(`https://movieapi.giftedtech.co.ke/api/sources/${movieId}`);
    const sourceData = await sourceRes.json();

    let txt = `üé¨ *Movie Found!*\n\n`;
    txt += `üìå *Title:* ${firstMovie.displayTitle}\n`;
    txt += `‚≠ê *Rating:* ${infoData.results.subject.rating?.value || "N/A"}\n`;
    txt += `üìÜ *Year:* ${infoData.results.subject.year || "Unknown"}\n\n`;

    txt += `üì• *Download Links:*\n`;

    if (sourceData?.results?.sources?.length > 0) {
      sourceData.results.sources.forEach((src, i) => {
        txt += `\n${i + 1}. üü¶ *${src.quality}* - ${src.size}\n${src.url}\n`;
      });
    } else {
      txt += `\n‚ö† No download links available.\n`;
    }

    await conn.sendMessage(m.chat, {
      image: { url: firstMovie.poster },
      caption: txt
    }, { quoted: mek });

  } catch (e) {
    console.log(e);
    m.reply("‚ùå Error: Something went wrong!");
  }
});
